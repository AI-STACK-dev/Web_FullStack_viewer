<!DOCTYPE html>
<html>
<head runat="server">
    <meta charset="UTF-8">
    <title>viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link href="css/viewer.css" rel="stylesheet" type="text/css"/>
    <style>
        .loader {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #9932cc; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            position: fixed;
            top:50%;
            left:50%;
            transform: translate(-50%,50%);
        }
        @keyframes spin {
            0% { transform:translate(-50%,50%) rotate(0deg); }
            100% { transform:translate(-50%,50%) rotate(360deg); }
        }


        #btn1{
            margin: 10px;
        }
        #btn{
            margin: 10px;
        }
        #btnSubmit{
            margin: 10px;
        }
    </style>
</head>
<body>
<div class="loader" id="loading" style="display:none"></div>

<h1 class="blind">Image Viewer</h1>



<div class="btn-group">
    <button type="button" id="btn1" onclick="window.close()">âŒClose</button>
    <div class="js-download">
        <canvas id="canvas" style="display:none"></canvas>
       <!-- <input type="button" value = "Download" id = "btn" onclick = "getfiledown()" /> -->
        <input type="button" id="btnSubmit" value="ğŸ“‚ë‹¤ìš´ë¡œë“œ"/>
        <button type="submit" onclick="Annotation()">ğŸ–Annotation Mode</button>
        <input type="button" value = "ğŸ–¥predict" id = "btn" onclick = "getAI()"/>
        <input type="button" value="Test" id="test_btn" onclick="javascript:test('./public/img/Pacman.gif');">
    </div>
</div>

<ul class="ajax-results"></ul>
</body>


<script src="js/Viewer.js"></script>
<script src="js/download.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/easyannotation"></script>
<script src ="js/jquery.Wheelzoom.js"></script>
<script>
    $(document).ready(function() {
        $('#ex5').wheelzoom();
    })
</script>
<script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    function showPer(per) {
        ctx.clearRect(0, 0, 400, 400);
        //ë°”ê¹¥ìª½ ì¨í´ ê·¸ë¦¬ê¸°
        ctx.strokeStyle = "#ff6666";
        ctx.lineWidth=10;
        ctx.beginPath();
        ctx.arc(60, 60, 50, 0, Math.PI * 2 * per / 100);
        ctx.stroke();
        //ìˆ«ì ì˜¬ë¦¬ê¸°
        ctx.font = '32px serif';
        ctx.fillStyle = "#000";
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(per + '%', 60, 60);
    }
     var name = getUrlValue();
     var url = '/img/' + name;
    $("#btnSubmit").on("click", function(e) {
        $.ajax({
            url: url,
            type : 'get',
            xhrFields: { //response ë°ì´í„°ë¥¼ ë°”ì´ë„ˆë¦¬ë¡œ ì²˜ë¦¬í•œë‹¤.
                responseType: 'blob'
            },
            beforeSend : function() { //ajax í˜¸ì¶œì „ progress ì´ˆê¸°í™”
                showPer(0);
                canvas.style.display = 'block';
            },
            xhr: function() { //XMLHttpRequest ì¬ì •ì˜ ê°€ëŠ¥
                var xhr = $.ajaxSettings.xhr();
                xhr.onprogress = function(e) {
                    showPer(Math.floor(e.loaded / e.total * 100));
                };
                return xhr;
            },
            success : function(data) {
                console.log("ì™„ë£Œ");
                var blob = new Blob([data]);
//íŒŒì¼ì €ì¥
                if (navigator.msSaveBlob) {
                    return navigator.msSaveBlob(blob, url);
                }
                else {
                    var link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = url;
                    link.click();
                }
            },
            complete : function() {
                canvas.style.display = 'none';
            }
        });
    });

    function getfiledown(){
        var name = getUrlValue();
        console.log('getfiledown' + name);
        window.location = '/download/' + name;
    }
    function getAI(){
     var name = getUrlValue();
     window.location = '/AI/' + name;

    }
    function getUrlValue(key) {
        //console.log(key);
        var valueObject = {}, hash, value;
        var hashes = window.location.href.slice(window.location.href.indexOf('?'));
        console.log(hashes);
        hash = hashes.split('=');
        //console.log(hash);
        valueObject[hash] = hash[1];
        //console.log(valueObject[hash]);
        num = valueObject[hash];
        if (key) {

            if (valueObject[key]) {
                return valueObject[key];
            }

            return "";
        }
        console.log(valueObject);
        return valueObject[hash];
    }
    function Annotation(){
        var move = confirm('Annotation Mode ë¡œ ì´ë™ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        if(move){
            var file_name = getUrlValue();
            console.log(file_name);
            window.location = "annotation.html?name="+ file_name;
        }
        else{
            return;
        }
    }
    //ì´ì¯¤ì—ì„œ scriptë¥¼ ì¶”ê°€í•´ì•¼ í• ë“¯

</script>
<script>
    $("#btn").on("click", function() {
        $(".loader").fadeIn(); // idê°€ "divBox"ì¸ ìš”ì†Œë¥¼ ëŠë¦¬ê²Œ ì ì  ë‚˜íƒ€ë‚˜ê²Œ í•¨.
    });
</script>
<script>
    function test(imageName) {
    LoadingWithMask('Pacman.gif');
    }

    function LoadingWithMask(gif){
        //í™”ë©´ì˜ ë†’ì´ì™€ ë„ˆë¹„ë¥¼ êµ¬í•©ë‹ˆë‹¤.
        var maskHeight = $(document).height();
        var maskWidth  = window.document.body.clientWidth;

        //í™”ë©´ì— ì¶œë ¥í•  ë§ˆìŠ¤í¬ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
        var mask       ="<div id='mask' style='position:absolute; z-index:9000; background-color:#000000; display:none; left:0; top:0;'>";


        mask +="<div id='loadingImg'>";
        mask +=" <img src='https://tistory2.daumcdn.net/tistory/1898109/skin/images/Pacman.gif'; align='center' style='position: relative; display: block; margin: 500px auto;'/>";
        mask +="</div>";

        mask += "</div>";
        //í™”ë©´ì— ë ˆì´ì–´ ì¶”ê°€
        $('body')
            .append(mask)

        //ë§ˆìŠ¤í¬ì˜ ë†’ì´ì™€ ë„ˆë¹„ë¥¼ í™”ë©´ ê²ƒìœ¼ë¡œ ë§Œë“¤ì–´ ì „ì²´ í™”ë©´ì„ ì±„ì›ë‹ˆë‹¤.
        $('#mask').css({
            'width' : maskWidth
            ,'height': maskHeight
            ,'opacity' :'0.3'
        });

        //ë§ˆìŠ¤í¬ í‘œì‹œ
        $('#mask').show();

        //ë¡œë”©ì¤‘ ì´ë¯¸ì§€ í‘œì‹œ
        //$('#loadingImg').show();

    }
</script>
</html>
